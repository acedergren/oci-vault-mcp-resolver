# Installation Script Demo

This document demonstrates the interactive installation process.

## Quick Start

```bash
# Navigate to project root
cd /home/alex/projects/oci-vault-mcp-resolver

# Run interactive installer
./scripts/install.sh

# Or preview changes first (dry-run)
./scripts/install.sh --dry-run
```

## Demo Output

### 1. Pre-flight Checks

```
════════════════════════════════════════════════════════════════
  Pre-flight Checks
════════════════════════════════════════════════════════════════

Checking required commands...
✓ python3 is installed (/usr/bin/python3)
✓ pip3 is installed (/usr/bin/pip3)
✓ oci is installed (/home/alex/.local/bin/oci)

Checking Python version...
✓ Python 3.12.3 (>= 3.8 required)

Checking Python dependencies...
✓ Python package 'yaml' is installed
✓ Python package 'oci' is installed

Checking OCI CLI configuration...
✓ OCI CLI config found at /home/alex/.oci/config
✓ Default region: eu-frankfurt-1

✓ All pre-flight checks passed
```

### 2. OCI Configuration Collection

```
════════════════════════════════════════════════════════════════
  OCI Configuration
════════════════════════════════════════════════════════════════

ℹ This installer will help you configure OCI Vault integration.
ℹ You'll need the following OCIDs from Oracle Cloud Infrastructure Console:

ℹ   1. Vault OCID - from Identity & Security > Vault
ℹ   2. Compartment OCID - from Identity & Security > Compartments
ℹ   3. Region - e.g., eu-frankfurt-1, us-ashburn-1

? Enter your OCI Vault OCID: ocid1.vault.oc1.eu-frankfurt-1.bfpizfqyaacmg...
? Enter your OCI Compartment OCID: ocid1.compartment.oc1..aaaaaaaarekfofhmf...
? Enter your OCI Region [eu-frankfurt-1]:

Cache Configuration
ℹ Secrets are cached locally to reduce API calls and improve performance.
? Cache TTL in seconds [3600]:

Authentication Method
ℹ Choose how to authenticate with OCI:
ℹ   • Config file (~/.oci/config) - For local development
ℹ   • Instance principals - For OCI compute instances

? Use instance principals (OCI VM/Container)? [y/N]: n
? OCI config file path [/home/alex/.oci/config]:
? OCI config profile [DEFAULT]:

✓ Configuration collected successfully
```

### 3. Configuration Generation

```
════════════════════════════════════════════════════════════════
  Generating Configuration
════════════════════════════════════════════════════════════════

Creating configuration directory...
✓ Created /home/alex/.config/oci-vault-mcp

Generating resolver configuration...
✓ Configuration written to /home/alex/.config/oci-vault-mcp/resolver.yaml
✓ Created cache directory at /home/alex/.cache/oci-vault-mcp
```

**Generated Configuration:**

```yaml
# OCI Vault MCP Resolver Configuration
# Generated by install.sh on 2026-01-08 14:20:00 UTC

# OCI Vault Configuration
vault:
  vault_ocid: "ocid1.vault.oc1.eu-frankfurt-1.bfpizfqyaacmg..."
  compartment_ocid: "ocid1.compartment.oc1..aaaaaaaarekfofhmf..."
  region: "eu-frankfurt-1"

# Authentication
auth:
  use_instance_principals: false
  config_file: "/home/alex/.oci/config"
  profile: "DEFAULT"

# Cache Configuration
cache:
  ttl: 3600
  directory: "/home/alex/.cache/oci-vault-mcp"

# Logging
logging:
  level: INFO  # DEBUG, INFO, WARNING, ERROR

# Resilience
resilience:
  max_retries: 3
  circuit_breaker_threshold: 5
  circuit_breaker_timeout: 60
```

### 4. Python Package Installation

```
════════════════════════════════════════════════════════════════
  Installing Python Package
════════════════════════════════════════════════════════════════

Installing oci-vault-mcp-resolver...
Obtaining file:///home/alex/projects/oci-vault-mcp-resolver
  Installing build dependencies ... done
  Checking if build backend supports build_editable ... done
  Getting requirements to build editable ... done
  Preparing editable metadata ... done
Building wheels for collected packages: oci-vault-mcp-resolver
  Building editable for oci-vault-mcp-resolver ... done
Successfully installed oci-vault-mcp-resolver-1.0.0
✓ Python package installed successfully

Verifying installation...
✓ CLI tool 'oci-vault-resolve' is available
```

### 5. Wrapper Scripts Installation

```
════════════════════════════════════════════════════════════════
  Installing Wrapper Scripts
════════════════════════════════════════════════════════════════

Installing mcp-with-vault wrapper...
? Install mcp-with-vault to /usr/local/bin? (requires sudo) [Y/n]: y
[sudo] password for alex:
✓ Installed mcp-with-vault to /usr/local/bin/mcp-with-vault
```

### 6. Example Secrets Upload (Optional)

```
════════════════════════════════════════════════════════════════
  Upload Example Secrets
════════════════════════════════════════════════════════════════

ℹ You can optionally upload example secrets to test the integration.

? Do you want to upload example secrets to OCI Vault? [y/N]: y

Example secrets to upload:
  • mcp-example-token (for testing token-based authentication)
  • mcp-example-api-key (for testing API key storage)

Uploading mcp-example-token...
✓ Uploaded mcp-example-token

Uploading mcp-example-api-key...
✓ Uploaded mcp-example-api-key

✓ Example secrets uploaded successfully
```

### 7. Installation Complete

```
════════════════════════════════════════════════════════════════
  Installation Complete
════════════════════════════════════════════════════════════════

✓ OCI Vault MCP Resolver has been installed successfully!

Configuration Summary:
  • Config file: /home/alex/.config/oci-vault-mcp/resolver.yaml
  • Cache directory: /home/alex/.cache/oci-vault-mcp
  • Vault OCID: ocid1.vault.oc1.eu-frankfurt-1...
  • Compartment OCID: ocid1.compartment.oc1..aaaaaaaare...
  • Region: eu-frankfurt-1
  • Auth method: Config file

Next Steps:

1. Test the resolver with a sample secret:
   oci-vault-resolve --test

2. Create secrets in OCI Vault (using the upload script):
   /home/alex/projects/oci-vault-mcp-resolver/upload-secret.sh \
     --vault-id ocid1.vault.oc1.eu-frankfurt-1... \
     --compartment-id ocid1.compartment.oc1... \
     my-secret-name my-secret-value

3. Use oci-vault:// URLs in your MCP configuration:
   oci-vault://ocid1.compartment.oc1.../my-secret-name

4. Resolve secrets in your config:
   oci-vault-resolve < your-config.yaml

5. Use with Docker MCP Gateway (if installed):
   mcp-with-vault --start

Documentation:
  • README: /home/alex/projects/oci-vault-mcp-resolver/README.md
  • API Reference: /home/alex/projects/oci-vault-mcp-resolver/API_REFERENCE.md
  • Quick Start: /home/alex/projects/oci-vault-mcp-resolver/QUICKSTART.md

Troubleshooting:
  • View logs: oci-vault-resolve --verbose < config.yaml
  • Clear cache: rm -rf /home/alex/.cache/oci-vault-mcp/*
  • Test OCI auth: oci iam region list

✓ Happy secret managing!
```

## Dry-Run Mode

Preview changes without making any modifications:

```bash
./scripts/install.sh --dry-run
```

Example dry-run output:

```
⚠ DRY RUN MODE: No changes will be made

[... pre-flight checks ...]

Generating Configuration
⚠ DRY RUN: Would create directory: /home/alex/.config/oci-vault-mcp
⚠ DRY RUN: Would write configuration to: /home/alex/.config/oci-vault-mcp/resolver.yaml

Generating resolver configuration...
⚠ DRY RUN: Would write the following configuration:
  # OCI Vault MCP Resolver Configuration
  [... config preview ...]

Installing Python Package
⚠ DRY RUN: Would run: pip3 install --user -e /home/alex/projects/oci-vault-mcp-resolver

⚠ DRY RUN completed - no changes were made
ℹ Run without --dry-run to perform actual installation
```

## Command-Line Options

```bash
# Show help
./scripts/install.sh --help

# Dry run (no changes)
./scripts/install.sh --dry-run

# Skip wrapper scripts installation
./scripts/install.sh --no-wrappers

# Skip example secrets upload
./scripts/install.sh --skip-secrets

# Combine options
./scripts/install.sh --dry-run --skip-secrets --no-wrappers
```

## Files Created

After installation, the following files are created:

```
~/.config/oci-vault-mcp/
└── resolver.yaml                    # Main configuration (permissions: 600)

~/.cache/oci-vault-mcp/
└── [cache files]                    # Secret cache (permissions: 700)

~/.local/lib/python3.x/site-packages/
└── oci-vault-mcp-resolver/          # Installed package

~/.local/bin/
└── oci-vault-resolve                # CLI tool

/usr/local/bin/                      # Optional (requires sudo)
└── mcp-with-vault                   # Wrapper script
```

## Uninstallation

To uninstall:

```bash
# Remove Python package
pip3 uninstall oci-vault-mcp-resolver

# Remove configuration
rm -rf ~/.config/oci-vault-mcp

# Remove cache
rm -rf ~/.cache/oci-vault-mcp

# Remove wrapper (requires sudo)
sudo rm /usr/local/bin/mcp-with-vault
```

## Troubleshooting

### Pre-flight Check Failures

**Problem:** `python3 is not installed`

**Solution:**
```bash
# Ubuntu/Debian
sudo apt install python3 python3-pip

# CentOS/RHEL
sudo yum install python3 python3-pip

# macOS
brew install python3
```

**Problem:** `oci CLI is not installed`

**Solution:**
```bash
# Install OCI CLI
bash -c "$(curl -L https://raw.githubusercontent.com/oracle/oci-cli/master/scripts/install/install.sh)"

# Configure
oci setup config
```

### Installation Errors

**Problem:** `Failed to install Python package`

**Solution:**
```bash
# Check pip3 is working
pip3 --version

# Try manual installation
cd /home/alex/projects/oci-vault-mcp-resolver
pip3 install --user -e .

# Check for missing dependencies
pip3 install --user PyYAML oci
```

**Problem:** `Permission denied` when installing wrappers

**Solution:**
```bash
# Skip wrapper installation
./scripts/install.sh --no-wrappers

# Or manually copy to user bin
cp mcp-with-vault ~/.local/bin/
chmod +x ~/.local/bin/mcp-with-vault
```

### Runtime Errors

**Problem:** `oci-vault-resolve: command not found`

**Solution:**
```bash
# Add ~/.local/bin to PATH
echo 'export PATH="$HOME/.local/bin:$PATH"' >> ~/.bashrc
source ~/.bashrc

# Or use full path
~/.local/bin/oci-vault-resolve --version
```

**Problem:** Authentication fails

**Solution:**
```bash
# Test OCI CLI authentication
oci iam region list

# Reconfigure if needed
oci setup config

# Check config file
cat ~/.oci/config
```

## Advanced Usage

### Custom Configuration

Edit the generated configuration file:

```bash
vim ~/.config/oci-vault-mcp/resolver.yaml
```

Available settings:
- `vault.vault_ocid` - Vault OCID
- `vault.compartment_ocid` - Compartment OCID
- `vault.region` - OCI region
- `auth.use_instance_principals` - Use instance principals (true/false)
- `auth.config_file` - OCI config file path
- `auth.profile` - OCI config profile name
- `cache.ttl` - Cache TTL in seconds
- `cache.directory` - Cache directory path
- `logging.level` - Log level (DEBUG, INFO, WARNING, ERROR)
- `resilience.max_retries` - Max retries for transient failures
- `resilience.circuit_breaker_threshold` - Circuit breaker threshold
- `resilience.circuit_breaker_timeout` - Circuit breaker timeout

### Multiple Environments

Use different configuration files for different environments:

```bash
# Production
export OCI_VAULT_CONFIG=~/.config/oci-vault-mcp/prod.yaml
oci-vault-resolve < prod-config.yaml

# Staging
export OCI_VAULT_CONFIG=~/.config/oci-vault-mcp/staging.yaml
oci-vault-resolve < staging-config.yaml
```

### CI/CD Integration

Use instance principals in CI/CD pipelines:

```bash
# GitHub Actions, GitLab CI, etc.
OCI_VAULT_CONFIG=/path/to/resolver.yaml \
  oci-vault-resolve < config.yaml > resolved-config.yaml
```

## Support

For issues or questions:

1. Check the documentation: `/home/alex/projects/oci-vault-mcp-resolver/README.md`
2. Run with verbose logging: `oci-vault-resolve --verbose < config.yaml`
3. Check OCI Vault audit logs in OCI Console
4. Open an issue on GitHub
